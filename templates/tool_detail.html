<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>SaberRecon â€“ {{ tool.title }}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="stylesheet" href="/static/styles.css">

  <style>
    :root{
      --ss-red:   rgb(163, 0, 21);
      --ss-teal:  rgb(32, 163, 158);
      --ss-cream: rgb(237, 235, 215);
      --ss-black: rgb(0, 0, 0);
      --ss-navy:  rgb(32, 44, 57);

      --bg-top:   rgb(22, 30, 40);
      --bg-mid:   rgb(10, 14, 18);
      --panel:    rgba(237,235,215,0.06);
      --panel2:   rgba(237,235,215,0.085);
      --border:   rgba(237,235,215,0.14);
      --border2:  rgba(237,235,215,0.22);

      --text:     rgb(244, 242, 226);
      --muted:    rgba(237,235,215,0.78);
      --muted2:   rgba(237,235,215,0.60);

      --tealGlow: rgba(32,163,158,0.22);
      --redGlow:  rgba(163,0,21,0.20);

      --radius: 18px;
      --shadow: 0 18px 60px rgba(0,0,0,.55);
    }

    * { box-sizing: border-box; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Apple Color Emoji","Segoe UI Emoji";
      color: var(--text);

      background:
        radial-gradient(900px 520px at 18% 12%, var(--tealGlow), transparent 58%),
        radial-gradient(820px 520px at 84% 18%, var(--redGlow), transparent 62%),
        linear-gradient(180deg, var(--bg-top) 0%, var(--bg-mid) 78%, var(--ss-black) 100%);
      min-height: 100vh;
    }

    a{ color: inherit; text-decoration: none; }

    .topbar{
      position: sticky;
      top: 0;
      z-index: 100;
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      background: rgba(0,0,0,0.55);
      border-bottom: 1px solid rgba(237,235,215,0.10);
    }

    .topbar-inner{
      max-width: 1160px;
      margin: 0 auto;
      padding: 14px 18px;
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 16px;
    }

    .brand{
      display:flex;
      align-items:center;
      gap: 14px;
      min-width: 260px;
    }

    .brand img{
      height: 58px;
      width: auto;
      border-radius: 14px;
      border: 1px solid rgba(237,235,215,0.14);
      box-shadow: 0 14px 40px rgba(0,0,0,.45);
      background: rgba(0,0,0,0.25);
    }

    .brand .name{
      font-weight: 900;
      letter-spacing: .2px;
      font-size: 20px;
      line-height: 1.1;
    }
    .brand .tag{
      font-size: 12px;
      color: var(--muted2);
      margin-top: 2px;
    }

    .nav{
      display:flex;
      align-items:center;
      gap: 18px;
      font-weight: 800;
      color: var(--muted);
    }
    .nav a{
      padding: 10px 12px;
      border-radius: 12px;
      transition: 140ms ease;
      border: 1px solid transparent;
    }
    .nav a:hover{
      background: rgba(237,235,215,0.06);
      border-color: rgba(237,235,215,0.10);
      color: var(--text);
    }
    .nav a.active{
      background: rgba(32,163,158,0.12);
      border: 1px solid rgba(32,163,158,0.28);
      color: var(--text);
      box-shadow: 0 0 0 3px rgba(32,163,158,0.08);
    }

    .accent-line{
      height: 3px;
      background: linear-gradient(
        90deg,
        rgba(163,0,21,0.0),
        rgba(163,0,21,0.85),
        rgba(32,163,158,0.75),
        rgba(32,163,158,0.0)
      );
      opacity: .85;
    }

    .wrap{
      max-width: 1160px;
      margin: 0 auto;
      padding: 34px 18px 120px;
    }

    .title-row{
      display:flex;
      align-items:flex-end;
      justify-content: space-between;
      gap: 18px;
      flex-wrap: wrap;
      margin-top: 10px;
      margin-bottom: 10px;
    }

    h1{
      margin: 0;
      font-size: 44px;
      letter-spacing: -0.6px;
    }

    .subtitle{
      margin: 8px 0 0;
      color: var(--muted);
      max-width: 820px;
      font-size: 16px;
      line-height: 1.65;
    }

    .divider{
      height: 1px;
      background: rgba(237,235,215,0.12);
      margin: 18px 0 22px;
    }

    .pill{
      display: inline-flex;
      align-items: center;
      gap: 10px;
      padding: 10px 12px;
      border-radius: 999px;
      border: 1px solid rgba(32,163,158,0.26);
      background: rgba(32,163,158,0.10);
      font-size: 12px;
      font-weight: 900;
      color: var(--text);
      box-shadow: 0 0 0 3px rgba(32,163,158,0.06);
      white-space: nowrap;
    }

    .card{
      background: linear-gradient(180deg, rgba(237,235,215,0.09), rgba(237,235,215,0.05));
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 18px 18px 16px;
      margin: 14px 0;
      position: relative;
      overflow: hidden;
    }
    .card:before{
      content:"";
      position:absolute;
      inset:-1px;
      background:
        radial-gradient(520px 260px at 18% 12%, rgba(32,163,158,0.16), transparent 60%),
        radial-gradient(520px 260px at 92% 16%, rgba(163,0,21,0.10), transparent 62%);
      opacity: .95;
      pointer-events:none;
    }
    .card > *{ position: relative; }

    .field-label{
      font-weight: 900;
      font-size: 13px;
      margin-bottom: 8px;
      color: var(--text);
    }

    input[type="text"], input[type="number"], select{
      width: 100%;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid rgba(237,235,215,0.16);
      background: rgba(237,235,215,0.06);
      color: var(--text);
      outline: none;
      box-sizing: border-box;
      transition: 140ms ease;
    }
    input::placeholder{ color: rgba(237,235,215,0.45); }
    select option{ color: #111; }

    input:focus, select:focus{
      border-color: rgba(32,163,158,0.42);
      box-shadow: 0 0 0 3px rgba(32,163,158,0.10);
      background: rgba(237,235,215,0.07);
    }

    .opt{
      display: block;
      padding: 12px 12px;
      border-radius: 16px;
      border: 1px solid rgba(237,235,215,0.12);
      background: rgba(237,235,215,0.045);
      margin: 10px 0;
      transition: 140ms ease;
    }
    .opt:hover{
      border-color: rgba(32,163,158,0.30);
      background: rgba(237,235,215,0.055);
    }

    .opt-top{
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 10px;
      flex-wrap: wrap;
      margin-bottom: 8px;
    }

    .opt-label{
      font-weight: 900;
      font-size: 13px;
      letter-spacing: 0.1px;
    }

    .hint{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      font-size: 12px;
      color: var(--muted);
      background: rgba(0,0,0,0.25);
      border: 1px solid rgba(237,235,215,0.14);
      padding: 4px 8px;
      border-radius: 999px;
      white-space: nowrap;
    }

    details.group{
      border: 1px solid rgba(237,235,215,0.14);
      background: rgba(237,235,215,0.05);
      border-radius: 16px;
      overflow: hidden;
      margin: 12px 0;
      box-shadow: 0 10px 34px rgba(0,0,0,.35);
    }
    details.group > summary{
      cursor: pointer;
      padding: 12px 14px;
      font-weight: 900;
      list-style: none;
      user-select: none;
      background: rgba(237,235,215,0.06);
      border-bottom: 1px solid rgba(237,235,215,0.10);
    }
    details.group[open] > summary{
      background: rgba(237,235,215,0.09);
    }
    details.group > summary::-webkit-details-marker { display:none; }

    .group-body{ padding: 12px 14px; }

    .empty-note{
      opacity: 0.75;
      color: var(--muted);
      font-size: 13px;
      padding: 8px 0 2px;
    }

    .cmd-bar{
      position: fixed;
      left: 0; right: 0; bottom: 0;
      z-index: 9999;
      background: rgba(0,0,0,0.62);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border-top: 1px solid rgba(237,235,215,0.12);
      padding: 12px 16px;
    }

    .cmd-inner{
      max-width: 1160px;
      margin: 0 auto;
      display:flex;
      gap: 10px;
      align-items:center;
      flex-wrap: wrap;
    }

    .cmd-preview{
      flex: 1;
      min-width: 260px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid rgba(237,235,215,0.16);
      background: rgba(237,235,215,0.06);
      color: var(--text);
    }

    .btn{
      border: 1px solid rgba(237,235,215,0.18);
      background: rgba(237,235,215,0.08);
      color: var(--text);
      padding: 10px 14px;
      border-radius: 14px;
      font-weight: 900;
      cursor: pointer;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      transition: 140ms ease;
    }
    .btn:hover{
      background: rgba(237,235,215,0.12);
      border-color: rgba(237,235,215,0.24);
    }

    .btn-primary{
      background: rgba(32,163,158,0.12);
      border-color: rgba(32,163,158,0.34);
    }
    .btn-primary:hover{
      background: rgba(32,163,158,0.16);
      border-color: rgba(32,163,158,0.46);
      box-shadow: 0 0 0 3px rgba(32,163,158,0.10);
    }

    .toast{
      position: fixed;
      right: 18px;
      bottom: 86px;
      background: rgba(0,0,0,0.75);
      border: 1px solid rgba(237,235,215,0.14);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 12px;
      font-size: 13px;
      opacity: 0;
      transform: translateY(8px);
      transition: opacity 0.2s ease, transform 0.2s ease;
      pointer-events: none;
    }
    .toast.show{ opacity: 1; transform: translateY(0); }

    @media (max-width: 600px){
      h1{ font-size: 36px; }
      .brand{ min-width: unset; }
      .brand .name, .brand .tag{ display:none; }
      .pill{ width: 100%; justify-content: center; }
    }
  </style>
</head>

<body>
  <header class="topbar">
    <div class="topbar-inner">
      <a href="/" class="brand">
        <img src="/static/SaberShieldLogoWithTextWithBackground.png" alt="SaberShield">
        <div>
          <div class="name">SaberRecon</div>
          <div class="tag">Beginner-friendly recon toolkit</div>
        </div>
      </a>

      <nav class="nav">
        <a href="/">Home</a>
        <a class="active" href="/tools">Tools</a>
        <a href="/history">History</a>
      </nav>
    </div>
    <div class="accent-line"></div>
  </header>

  <main class="wrap">
    <div class="title-row">
      <div>
        <h1>{{ tool.title }}</h1>
        <p class="subtitle">
          Select flags to build a command preview. When you click <strong>Run</strong>, SaberRecon executes the tool inside your container.
        </p>
      </div>

      <div class="pill">
        Tool ID:
        <span style="font-family: ui-monospace, monospace; opacity:0.95;">
          {{ tool_id }}
        </span>
      </div>
    </div>

    <div class="divider"></div>

    <form method="POST" action="/run-tool" id="toolForm">
      <input type="hidden" name="tool_id" value="{{ tool_id }}">

      <!-- Target -->
      <div class="card">
        <div class="field-label">Target</div>
        <input name="target" id="targetInput" type="text" placeholder="https://example.com or example.com" required>
      </div>

      {# Build groups: use tool.groups if present, else put tool.options into one group #}
      {% if tool.groups is defined and tool.groups %}
        {% set groups = tool.groups %}
      {% else %}
        {% set groups = [{"name":"Options","options": (tool.options if tool.options is defined else [])}] %}
      {% endif %}

      {% for group in groups %}
        <details class="group" {% if loop.first %}open{% endif %}>
          <summary>{{ group.name }}</summary>
          <div class="group-body">

            {% if group.options is not defined or (group.options | length) == 0 %}
              <div class="empty-note">No options in this category.</div>
            {% else %}

              {% for opt in group.options %}

                {% if opt.type == "bool" %}
                  <label class="opt">
                    <div class="opt-top">
                      <div class="opt-label">{{ opt.label }}</div>
                      <div class="hint">{{ opt.flag }}</div>
                    </div>
                    <div>
                      <input type="checkbox" name="{{ opt.flag }}" {% if opt.default %}checked{% endif %}>
                      <span style="opacity:0.8; font-size:13px; margin-left:8px; color: var(--muted);">Enable</span>
                    </div>
                  </label>
                {% endif %}

                {% if opt.type == "int" %}
                  <label class="opt">
                    <div class="opt-top">
                      <div class="opt-label">{{ opt.label }}</div>
                      <div class="hint">{{ opt.flag }}</div>
                    </div>
                    <input type="number"
                           name="{{ opt.flag }}"
                           value="{{ opt.default if opt.default is defined else '' }}"
                           {% if opt.min is defined %}min="{{ opt.min }}"{% endif %}
                           {% if opt.max is defined %}max="{{ opt.max }}"{% endif %}>
                  </label>
                {% endif %}

                {% if opt.type == "count" %}
                  <label class="opt">
                    <div class="opt-top">
                      <div class="opt-label">{{ opt.label }}</div>
                      <div class="hint">{{ opt.flag }}</div>
                    </div>
                    <input type="number"
                           name="{{ opt.flag }}"
                           value="{{ opt.default if opt.default is defined else 0 }}"
                           min="0" max="5">
                    <div style="opacity:0.75; font-size:12px; margin-top:8px; color: var(--muted);">
                      Tip: for flags like <span class="hint">{{ opt.flag }}</span> you can increase the number to repeat it.
                    </div>
                  </label>
                {% endif %}

                {% if opt.type == "str" %}
                  <label class="opt">
                    <div class="opt-top">
                      <div class="opt-label">{{ opt.label }}</div>
                      <div class="hint">{{ opt.flag }}</div>
                    </div>
                    <input type="text" name="{{ opt.flag }}" value="{{ opt.default if opt.default is defined else '' }}">
                  </label>
                {% endif %}

                {% if opt.type == "choice" %}
                  <label class="opt">
                    <div class="opt-top">
                      <div class="opt-label">{{ opt.label }}</div>
                      <div class="hint">{{ opt.flag }}</div>
                    </div>
                    <select name="{{ opt.flag }}">
                      <option value="">(none)</option>
                      {% for c in opt.choices %}
                        <option value="{{ c }}" {% if opt.default is defined and opt.default == c %}selected{% endif %}>{{ c }}</option>
                      {% endfor %}
                    </select>
                  </label>
                {% endif %}

              {% endfor %}

            {% endif %}
          </div>
        </details>
      {% endfor %}

      <div class="cmd-bar">
        <div class="cmd-inner">
          <input type="text" id="cmdPreview" class="cmd-preview" readonly>
          <button type="submit" class="btn btn-primary">Run</button>
          <button type="button" class="btn" id="copyBtn">Copy</button>
          <a class="btn" href="/tools">Back</a>
        </div>
      </div>
    </form>
  </main>

  <div class="toast" id="toast">Copied!</div>

  <script>
    const tool = {{ tool | tojson }};
    const base = tool.base || [];
    const kind = tool.kind || "url";

    const options = (() => {
      if (tool.groups && Array.isArray(tool.groups)) {
        return tool.groups.flatMap(g => (g.options || []));
      }
      return tool.options || [];
    })();

    const form = document.getElementById('toolForm');
    const preview = document.getElementById('cmdPreview');
    const toast = document.getElementById('toast');
    const copyBtn = document.getElementById('copyBtn');

    function normalizeTarget(t) {
      t = (t || '').trim();
      if (!t) return '';
      if (!t.includes('://')) t = 'https://' + t;
      try {
        const u = new URL(t);
        return u.host || t;
      } catch {
        return t.replace(/^https?:\/\//, '').replace(/\/+$/, '');
      }
    }

    function buildPreview() {
      const fd = new FormData(form);
      const target = (fd.get('target') || '').toString();
      const domain = normalizeTarget(target);
      const url = domain ? ('https://' + domain) : '';

      let args = [...base];

      for (const opt of options) {
        const flag = opt.flag;

        if (opt.type === 'bool') {
          if (fd.get(flag) !== null) args.push(flag);
        }

        if (opt.type === 'count') {
          const n = parseInt((fd.get(flag) || '0').toString(), 10);
          if (!isNaN(n) && n > 0) {
            for (let i = 0; i < n; i++) args.push(flag);
          }
        }

        if (opt.type === 'int') {
          const v = (fd.get(flag) || '').toString().trim();
          if (v && v !== '0') args.push(flag, v);
        }

        if (opt.type === 'str' || opt.type === 'choice') {
          const v = (fd.get(flag) || '').toString().trim();
          if (v) args.push(flag, v);
        }
      }

      if (domain) {
        args.push(kind === 'domain' ? domain : url);
      }

      preview.value = args.join(' ');
    }

    function showToast(msg) {
      toast.textContent = msg;
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), 900);
    }

    copyBtn.addEventListener('click', async () => {
      try {
        await navigator.clipboard.writeText(preview.value || '');
        showToast('Copied!');
      } catch (e) {
        showToast('Copy failed');
      }
    });

    form.addEventListener('input', buildPreview);
    buildPreview();
  </script>
</body>
</html>
